<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Depot Scheme Validator — Live (Safe)</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

  :root{
    --bg: linear-gradient(180deg,#f7fbff 0%, #eef9ff 100%);
    --card: rgba(255,255,255,0.9);
    --muted:#5b6b7a;
    --accent-1:#7c4dff;
    --accent-2:#06b6d4;
    --soft-shadow: 0 12px 34px rgba(16,24,40,0.08);
    --subtle: rgba(16,24,40,0.04);
    --gap:12px;
    --radius:14px;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#0b1220;background:var(--bg)}
  .container{max-width:1200px;margin:28px auto;padding:20px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  h1{font-size:20px;margin:0;color:#061129}
  .sub{color:var(--muted);font-size:13px}
  .tabs{display:flex;gap:8px;margin-top:18px}
  .tab{padding:8px 14px;border-radius:10px;background:transparent;border:1px solid transparent;color:var(--muted);cursor:pointer}
  .tab.active{background:linear-gradient(90deg, rgba(124,77,255,0.12), rgba(6,182,212,0.08));box-shadow:var(--soft-shadow);color:#08102a;font-weight:600}
  .card{background:var(--card);padding:18px;border-radius:var(--radius);margin-top:16px;border:1px solid var(--subtle);box-shadow:var(--soft-shadow)}
  .flex{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  input[type="text"], input[type="number"], select { background:#fff;border:1px solid rgba(11,17,26,0.06);padding:10px;border-radius:10px;min-height:36px}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid rgba(11,17,26,0.06);cursor:pointer;background:linear-gradient(180deg,#fff,#f7fbff)}
  .btn.primary{background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:#fff;border:0}
  table{width:100%;border-collapse:collapse;margin-top:12px;font-size:14px;border-radius:8px;overflow:hidden}
  th,td{padding:10px;border-bottom:1px solid rgba(11,17,26,0.04);text-align:left}
  th{color:var(--muted);font-weight:700;font-size:13px;background:linear-gradient(180deg,rgba(124,77,255,0.03),rgba(6,182,212,0.02))}
  .small{font-size:13px;color:var(--muted)}
  .alloc-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:var(--gap);align-items:end;width:100%}
  .alloc-grid .full-row{grid-column:1/-1;display:flex;justify-content:center;margin-top:10px}
  .footer-brand{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#f0fbfa}
</style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <h1>Depot Scheme Validator — Live (Safe)</h1>
      <div class="sub">Crash-proof · 6-decimal precision</div>
    </div>
    <div class="small">Offline/Online Ready</div>
  </header>

  <div class="tabs">
    <button class="tab active" data-tab="alloc">Allocations</button>
    <button class="tab" data-tab="validate">Validation</button>
    <button class="tab" data-tab="report">Report</button>
    <button class="tab" data-tab="data">Data</button>
  </div>

  <!-- Data Tab -->
  <div id="data" class="card tabpanel" style="display:none">
    <div class="flex" style="align-items:flex-start">
      <div style="flex:1">
        <strong>Depot Names</strong>
        <div class="small">Add / remove depot names</div>
        <div style="margin-top:10px" class="flex">
          <input id="newDepot" type="text" placeholder="Depot name"/>
          <button id="addDepotBtn" class="btn primary">Add</button>
        </div>
        <ul id="depotList"></ul>
      </div>
      <div style="flex:1">
        <strong>Scheme Names</strong>
        <div class="small">Add / remove schemes</div>
        <div style="margin-top:10px" class="flex">
          <input id="newScheme" type="text" placeholder="Scheme name"/>
          <button id="addSchemeBtn" class="btn primary">Add</button>
        </div>
        <ul id="schemeList"></ul>
      </div>
    </div>
  </div>

  <!-- Allocations Tab -->
  <div id="alloc" class="card tabpanel">
    <div class="alloc-grid">
      <div>
        <label class="small">Depot</label><br>
        <select id="depotSelect"><option value="">-- select depot --</option></select>
      </div>
      <div>
        <label class="small">Scheme</label><br>
        <select id="schemeSelect"><option value="">-- select scheme --</option></select>
      </div>
      <div>
        <label class="small">Commodity</label><br>
        <select id="commoditySelect"><option>Rice</option><option>Wheat</option></select>
      </div>
      <div>
        <label class="small">RO No</label><br>
        <input id="roInput" type="text"/>
      </div>
      <div>
        <label class="small">Qty</label><br>
        <input id="qtyInput" type="number" step="any"/>
      </div>
      <div class="full-row">
        <button id="addAllocBtn" class="btn primary">Save Allocation</button>
      </div>
    </div>

    <table id="allocTable">
      <thead><tr><th>#</th><th>Depot</th><th>Scheme</th><th>Commodity</th><th>RO</th><th>Allocated</th><th>Issued</th><th>Balance</th><th>Remarks</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Validation Tab -->
  <div id="validate" class="card tabpanel" style="display:none">
    <p class="small">Upload portal export file and validate.</p>
  </div>

  <!-- Report Tab -->
  <div id="report" class="card tabpanel" style="display:none">
    <p class="small">Report will appear here.</p>
  </div>

  <footer style="margin-top:20px">
    <div class="footer-brand">Gowtham Projects</div>
  </footer>
</div>

<script>
/* Safe storage + defaults */
const DATA_KEY = 'depot_data_lists_vfs';
const ALLOC_KEY = 'depot_allocations_vfs';
let dataLists = { depots: [], schemes: [] };
let allocations = [];

function loadDataLists(){
  try {
    const raw = localStorage.getItem(DATA_KEY);
    const parsed = raw ? JSON.parse(raw) : { depots: [], schemes: [] };
    if (!parsed || typeof parsed !== 'object') throw "bad";
    dataLists = {
      depots: Array.isArray(parsed.depots) ? parsed.depots : [],
      schemes: Array.isArray(parsed.schemes) ? parsed.schemes : []
    };
  } catch { dataLists = { depots: [], schemes: [] }; }
}
function saveDataLists(){ localStorage.setItem(DATA_KEY, JSON.stringify(dataLists)); }

function loadAllocations(){
  try {
    const raw = localStorage.getItem(ALLOC_KEY);
    const parsed = raw ? JSON.parse(raw) : [];
    allocations = Array.isArray(parsed) ? parsed : [];
  } catch { allocations = []; }
}
function saveAllocations(){ localStorage.setItem(ALLOC_KEY, JSON.stringify(allocations)); }

/* Safe populate */
function populateSelects(){
  if (!dataLists || typeof dataLists !== 'object') dataLists = { depots: [], schemes: [] };
  if (!Array.isArray(dataLists.depots)) dataLists.depots = [];
  if (!Array.isArray(dataLists.schemes)) dataLists.schemes = [];
  const depotSel = document.getElementById('depotSelect');
  const schemeSel = document.getElementById('schemeSelect');
  depotSel.innerHTML = '<option value="">-- select depot --</option>';
  schemeSel.innerHTML = '<option value="">-- select scheme --</option>';
  dataLists.depots.forEach(d => depotSel.insertAdjacentHTML('beforeend', `<option>${d}</option>`));
  dataLists.schemes.forEach(s => schemeSel.insertAdjacentHTML('beforeend', `<option>${s}</option>`));
}

/* Render lists */
function renderDataLists(){
  const depotListEl = document.getElementById('depotList');
  depotListEl.innerHTML = '';
  dataLists.depots.forEach((d,i)=> depotListEl.insertAdjacentHTML('beforeend', `<li>${d} <button onclick="deleteDepot(${i})">x</button></li>`));
  const schemeListEl = document.getElementById('schemeList');
  schemeListEl.innerHTML = '';
  dataLists.schemes.forEach((s,i)=> schemeListEl.insertAdjacentHTML('beforeend', `<li>${s} <button onclick="deleteScheme(${i})">x</button></li>`));
}

function deleteDepot(i){ dataLists.depots.splice(i,1); saveDataLists(); renderDataLists(); populateSelects(); }
function deleteScheme(i){ dataLists.schemes.splice(i,1); saveDataLists(); renderDataLists(); populateSelects(); }

/* Render allocations */
function renderAllocTable(){
  const tbody = document.querySelector('#allocTable tbody');
  tbody.innerHTML = '';
  allocations.forEach((a,i)=>{
    const bal = (Number(a.allocated||0)-Number(a.issued||0)).toFixed(6);
    tbody.insertAdjacentHTML('beforeend', `<tr><td>${i+1}</td><td>${a.depot}</td><td>${a.scheme}</td><td>${a.commodity}</td><td>${a.ro}</td><td>${(a.allocated||0).toFixed?.(6) || a.allocated}</td><td>${(a.issued||0).toFixed?.(6) || a.issued}</td><td>${bal}</td><td>${a.remarks||''}</td></tr>`);
  });
}

/* Events */
document.getElementById('addDepotBtn').onclick = ()=>{ const v=document.getElementById('newDepot').value.trim(); if(v && !dataLists.depots.includes(v)){ dataLists.depots.push(v); saveDataLists(); renderDataLists(); populateSelects(); } document.getElementById('newDepot').value=''; };
document.getElementById('addSchemeBtn').onclick = ()=>{ const v=document.getElementById('newScheme').value.trim(); if(v && !dataLists.schemes.includes(v)){ dataLists.schemes.push(v); saveDataLists(); renderDataLists(); populateSelects(); } document.getElementById('newScheme').value=''; };
document.getElementById('addAllocBtn').onclick = ()=>{ const depot=document.getElementById('depotSelect').value; const scheme=document.getElementById('schemeSelect').value; const commodity=document.getElementById('commoditySelect').value; const ro=document.getElementById('roInput').value; const qty=Number(document.getElementById('qtyInput').value)||0; if(!depot||!scheme) return alert('Select depot and scheme'); allocations.push({ depot, scheme, commodity, ro, allocated: qty, issued: 0, remarks:'' }); saveAllocations(); renderAllocTable(); };

document.querySelectorAll('.tab').forEach(btn=>btn.onclick=()=>{ document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); btn.classList.add('active'); document.querySelectorAll('.tabpanel').forEach(p=>p.style.display='none'); document.getElementById(btn.dataset.tab).style.display='block'; });

/* Init */
loadDataLists(); loadAllocations(); populateSelects(); renderDataLists(); renderAllocTable();
</script>
</body>
</html>
